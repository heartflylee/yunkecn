<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>设置</title>
    <link href="../css/reset.css" rel="stylesheet" type="text/css"/>
    <link href="../css/main.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="../css/head.css"/>
    <script type="text/javascript" src="../js/jquery-1.8.0.min.js"></script>
    <script src="../js/audio.js"></script>
    <script type="text/javascript" src="../js/main.js"></script>
    <link rel="stylesheet" href="../css/zTreeStyle.css">
    <script src="../js/jquery.ztree.core.js"></script>
    <!--<script src="../js/jquery.ztree.excheck.js"></script>-->
    <script src="../js/jquery.ztree.exedit.js"></script>
</head>

<body>
<!-- 页面遮罩层 layer -->
<div class="layer"></div>
<div class="layer-1"></div>
<!-- 页面头部 header -->
<div class="header">
    <h1 class="logo fl"></h1>
    <span class="mar fl">|</span>
    <span class="fl"><em>团队版</em>[<a href="">点击切换</a>]</span>
    <ul class="nav">
        <li>
            <a href="indexnew2.html">首页</a>
        </li>
        <li>
            <a href="customer1.html">客户</a>
        </li>
        <li>
            <a href="download.html">线索</a>
        </li>
        <li>
            <a href="task.html">任务</a>
        </li>
        <li>
            <a href="settings.html" id="top-setting" class="current">设置</a>
        </li>
    </ul>
    <ul class="header-right fr">
        <li>
            <a href="javascript:;"><i class="add"></i></a>
        </li>
        <li>
            <a href="javascript:;"><i class="update"></i></a>
        </li>
        <li>
            <a href="javascript:;"><i class="message"></i></a>
        </li>
        <li>
            <a href="javascript:;" class="user">刘</a>
        </li>
    </ul>
</div>
<!-- 汇总提示 tipArea -->
<div class="tipArea">
    <div class="wrap">
        <ul class="ul-2">
            <li>
                <a href="settings.html">团队设置</a>
            </li>
            <li>
                <a href="settings-1.html">外呼标签设置</a>
            </li>
            <li>
                <a href="settings-2.html">短信模板设置</a>
            </li>
            <li>
                <a href="settings-email.html">邮件账户设置</a>
            </li>
            <li>
                <a href="settings-email1.html">邮件模板设置</a>
            </li>
            <li>
                <a href="settings-call.html">挂机时间设置</a>
            </li>
            <li>
                <a href="settings-sea.html">企业公海设置</a>
            </li>
            <li>
                <a href="settings-task.html">云电销设置</a>
            </li>
            <li>
                <a href="function.html" class="current">用户和权限</a>
            </li>
        </ul>
    </div>
</div>
<!-- 内容部分 contents -->
<div class="contents manage-wrap">
    <div class="manage-menu">
        <a class="manage-li " href="function.html">
            <i class="icon function-icon"></i>
            职能管理
        </a>
        <a class="manage-li active" href="department.html">
            <i class="icon department-icon"></i>
            部门管理
        </a>
    </div>
    <div class="manage-main">
        <div class="manage-title">
            部门管理
        </div>
        <div class="manage-block">
            <div class="manage-left">
                <!--<div class="department-search">-->
                <!--<input type="button" class="search-btn" value="展开"/>-->
                <!--<div class="input-wrap">-->
                <!--<input type="text" class="input" placeholder="搜索部门">-->
                <!--</div>-->
                <!--</div>-->
                <div class="">
                    <ul id="tree" class="ztree department-tree"></ul>
                </div>
            </div>
            <div class="manage-content">
                <div class="manage-con-top">
                    <input type="text" class="staff-search" placeholder="搜索员工">
                    <input type="button" class="staff-btn" value="搜索">
                    <div class="depart-top">
                        <label class="depart-checkNum">
                            已选中<span>3</span>人
                        </label>
                        <a class="depart-href" href="javascript:void(0)" onclick="editorStaff();">编辑</a>
                        <span class="depart-line">|</span>
                        <a class="depart-href" href="javascript:void(0)" onclick="departManage();">设置为管理员</a>
                        <span class="depart-line">|</span>
                        <a class="depart-href" href="javascript:void(0)" onclick="departChange();">变更部门</a>
                    </div>
                </div>
                <div class="manage-con-title">
                    <i></i>
                    <label>员工列表</label>
                </div>
                <div class="manage-info">
                    <div class="depart-table">
                        <table class="table-list" id="table-list">
                            <tr>
                                <th class="th1"><i></i></th>
                                <th>姓名</th>
                                <th>手机号</th>
                                <th>职能</th>
                                <th>职位</th>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成 <span class="positon">管理员</span></td>
                                <td>13600000000</td>
                                <td>默认管理员</td>
                                <td>销售经理</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>管理员</td>
                                <td>销售</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>默认员工</td>
                                <td>销售</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>默认员工</td>
                                <td>销售</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>默认员工</td>
                                <td>销售</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>默认员工</td>
                                <td>销售</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>默认员工</td>
                                <td>销售</td>
                            </tr>
                            <tr>
                                <td><i></i></td>
                                <td>徐东成</td>
                                <td>13600000000</td>
                                <td>默认员工</td>
                                <td>销售</td>
                            </tr>
                        </table>
                    </div>
                    <div class="page-wrap">
                        <p class="page-p">共20条</p>
                        <ul class="page-ul">
                            <li>
                                <<
                            </li>
                            <li>
                                <
                            </li>
                            <li> 1</li>
                            <li> 2</li>
                            <li class="page-d">...</li>
                            <li> 3</li>
                            <li> ></li>
                            <li>>></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--新建部门-->
<div class="changer-box depart-new" id="depart-new">
    <div class="tlt"><i></i>新建部门
        <a href="javascript:layerClose('#depart-new');" class="a-closed"></a>
    </div>
    <div class="function-content">
        <div class="function-row">
            <div class="function-name">
                部门名称
            </div>
            <div class="function-info">
                <input type="text" class="input" placeholder="请输入部门名称"/>
            </div>
        </div>
        <div class="manage-btn-wrap">
            <input type="button" class="manage-btn" value="确定"/>
        </div>
    </div>
</div>
<!--新建部门-->

<!--编辑部门-->
<div class="changer-box depart-new" id="depart-editor">
    <div class="tlt"><i></i>编辑部门
        <a href="javascript:layerClose('#depart-editor');" class="a-closed"></a>
    </div>
    <div class="function-content">
        <div class="function-row">
            <div class="function-name">
                部门名称
            </div>
            <div class="function-info">
                <input type="text" class="input" placeholder="请输入部门名称"/>
            </div>
        </div>
        <div class="manage-btn-wrap">
            <input type="button" class="manage-btn" value="确定"/>
        </div>
    </div>
</div>
<!--编辑部门-->

<!--编辑员工-->
<div class="changer-box staff-editor" id="staff-editor">
    <div class="tlt"><i></i>编辑员工
        <a href="javascript:layerClose('#staff-editor');" class="a-closed"></a>
    </div>
    <div class="function-content">
        <div class="function-row">
            <div class="function-name">
                云客账号
            </div>
            <div class="function-info">
                13601129728
            </div>
        </div>
        <div class="function-row">
            <div class="function-name">
                员工姓名
            </div>
            <div class="function-info">
                <input type="text" class="input" placeholder="请输入员工姓名" value="王秀莲"/>
            </div>
        </div>
        <div class="function-row">
            <div class="function-name">
                性别
            </div>
            <div class="function-info">
                <label class="radio-label"><input type="radio" name="gender"><i class="radio-icon"></i>男</label>
                <label class="radio-label"><input type="radio" name="gender"><i class="radio-icon"></i>女</label>
            </div>
        </div>
        <div class="function-row">
            <div class="function-name">
                手机号码
            </div>
            <div class="function-info">
                <input type="text" class="input" placeholder="请输入手机号码" value="13601129728"/>
            </div>
        </div>
        <div class="function-row">
            <div class="function-name">
                职位
            </div>
            <div class="function-info">
                <input type="text" class="input" placeholder="请输入职位" value="销售经理"/>
            </div>
        </div>
        <div class="function-row">
            <div class="function-name">
                职能
            </div>
            <div class="function-info">
                <select>
                    <option value="">请选择职能</option>
                    <option value="">默认管理员</option>
                    <option value="">管理员</option>
                    <option value="">员工</option>
                </select>
            </div>
        </div>
        <div class="manage-btn-wrap">
            <input type="button" class="manage-btn" value="确定"/>
        </div>
    </div>
</div>
<!--编辑员工-->

<!--设为部门管理员-->
<div class="changer-box depart-manage" id="depart-manage">
    <div class="tlt"><i></i>设为部门管理员
        <a href="javascript:layerClose('#depart-manage');" class="a-closed"></a>
    </div>
    <div class="function-content">
        <div class="power-wrap">
            <div class="power-title">数据权限</div>
            <label class="radio-label"><input type="radio" name="power"/><i class="radio-icon"></i>本人</label>
            <label class="radio-label"><input type="radio" name="power"/><i class="radio-icon"></i>本部门</label>
            <label class="radio-label"><input type="radio" name="power"/><i class="radio-icon"></i>本部门及下属部门</label>
            <label class="radio-label"><input type="radio" name="power"/><i class="radio-icon"></i>全部</label>
        </div>
        <div class="manage-btn-wrap">
            <input type="button" class="manage-btn" value="确定"/>
        </div>
    </div>
</div>
<!--设为部门管理员-->

<!--变更部门-->
<div class="changer-box depart-new" id="depart-change">
    <div class="tlt"><i></i>变更部门
        <a href="javascript:layerClose('#depart-change');" class="a-closed"></a>
    </div>
    <div class="function-content">
        <div class="function-row">
            <div class="function-name">
                选择部门
            </div>
            <div class="function-info">
                <input type="text" class="input" id="department" readonly="readonly" value="市场部"/>
                <i class="depart-add" onclick="departChose(event)"></i>
                <div class="depart-tree" id="departTree-wrap">
                    <ul id="depart-tree" class="ztree department-tree"></ul>
                </div>
            </div>
        </div>
        <div class="manage-btn-wrap">
            <input type="button" class="manage-btn" value="确定"/>
        </div>
    </div>
</div>
<!--变更部门-->

<script>
    var setting = {
        view: {
            addHoverDom: addHoverDom,
            removeHoverDom: removeHoverDom,
            selectedMulti: false,
            showIcon: false,
            fontCss: {'font-weight': 'bold'}
        },
        check: {
            enable: false
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        edit: {
            enable: true,
            showRemoveBtn: showRemoveBtn,
            removeTitle: "删除",
            renameTitle: "编辑"
        },
        callback: {
            beforeEditName: beforeEditName,
            beforeRemove: beforeRemove,
            onMouseDown: onMouseDown
        }
    }
    var departSetting = {
        view: {
            selectedMulti: false,
            showIcon: false,
            fontCss: {'font-weight': 'bold'}
        },
        check: {
            enable: false
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        edit: {
            enable: false
        },
        callback: {
            onMouseDown: departSelect
        }
    }

    //显示添加节点
    function addHoverDom(treeId, treeNode) {
        var sObj = $("#" + treeNode.tId + "_span");
        if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
        var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
            + "' title='添加' onfocus='this.blur();'></span>";
        sObj.after(addStr);
        var btn = $("#addBtn_" + treeNode.tId);
        if (btn) btn.bind("click", function () {
            newDepart();
            return false;
        });
    };

    //去除添加节点
    function removeHoverDom(treeId, treeNode) {
        $("#addBtn_" + treeNode.tId).unbind().remove();
    }

    //删除节点（根节点不显示删除）
    function showRemoveBtn(treeId, treeNode) {
        return !(treeNode.parentTId == null);
    }

    //编辑前设置
    function beforeEditName(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj("tree");
        zTree.selectNode(treeNode);
        editorDepart();
        return false;
    }

    //删除
    function beforeRemove(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj("tree");
        zTree.selectNode(treeNode);
        return confirm("确认删除  " + treeNode.name + " 吗？");
    }

    //选择部门
    function onMouseDown(event, treeId, treeNode) {
        //选中部门
    }

    //变更中选择部门
    function departSelect(event, treeId, treeNode) {
        if (treeNode != null) {
            $("#department").val(treeNode.name);
            var zTree = $.fn.zTree.getZTreeObj("depart-tree");
            zTree.selectNode(treeNode);
            $("#departTree-wrap").hide();
        }
    }

    var zNodes = [{
        name: "全公司", open: true,
        children: [
            {
                name: "销售部",
                children: [
                    {name: "销售部1"},
                    {name: "销售部2"},
                    {name: "销售部3"},
                    {name: "销售部4"}
                ]
            },
            {
                name: "市场部",
                children: [
                    {name: "市场部1"},
                    {name: "市场部2"},
                    {name: "市场部3"},
                    {name: "市场部4市场部4市场部4市场部4市场部4"}
                ]
            }
        ]
    }];


    //默认设置树形结构
    $(document).ready(function () {
        $.fn.zTree.init($("#tree"), setting, zNodes);
        $.fn.zTree.init($("#depart-tree"), departSetting, zNodes);
    });


    //关闭弹框
    function layerClose(obj) {
        $(obj).hide();
        $(".layer").hide();
    }

    //新建职能弹框
    function newDepart() {
        $(".layer").show();
        $("#depart-new").show();
    }

    //编辑职能弹框
    function editorDepart() {
        $(".layer").show();
        $("#depart-editor").show();
    }

    //编辑员工
    function editorStaff() {
        $(".layer").show();
        $("#staff-editor").show();
    }

    //设为管理员
    function departManage() {
        $(".layer").show();
        $("#depart-manage").show();
    }

    //设为管理员
    function departChange() {
        $(".layer").show();
        $("#depart-change").show();
    }

    //选择部门
    function departChose(event) {
        $("#departTree-wrap").show();
        var department = $("#department").val().trim();
        if (department != '') {
            var zTree = $.fn.zTree.getZTreeObj("depart-tree");
            var Param = zTree.getNodesByParamFuzzy("name", $("#department").val().trim());
            zTree.selectNode(Param[0]);
        }
        event.stopPropagation();
    }

    //变更部门，点击弹框空白处隐藏选择部门下拉
    $(function () {
        $("#depart-change").click(function () {
            $("#departTree-wrap").hide();
        });
        $("#departTree-wrap").click(function (event) {
            event.stopPropagation();
        });
    });

    $(function () {
        $('#table-list td i,th i').on('click', function () {
            if ($("#table-list td i.choose-right").length > 0) {
                $(".depart-top").addClass("active");
            } else {
                $(".depart-top").removeClass("active");
            }
            $(".depart-checkNum span").text($("#table-list td i.choose-right").length);

        });
    });


</script>
</body>
</html>