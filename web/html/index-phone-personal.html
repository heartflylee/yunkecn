<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>团队首页</title>

    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <link type="image/x-icon" href="../images/favicon.ico" rel="icon">
    <link href="../css/reset.css" rel="stylesheet" type="text/css"/>

    <link href="../css/main.css" rel="stylesheet" type="text/css"/>
    <!--<link href="../css/main.css" rel="stylesheet" type="text/css" />-->
    <link rel="stylesheet" href="../css/head.css"/>
    <script type="text/javascript" src="../js/jquery-1.8.0.min.js"></script>

    <link href="../css/hDate.css" rel="stylesheet"/>
    <script type="text/javascript" src="../js/hDate.js"></script>
    <script type="text/javascript" src="../js/jedate/jedate.js"></script>

    <script src="../js/swiper.js"></script>
    <link rel="stylesheet" href="../css/swiper.css">

    <script type="text/javascript" src="../js/main.js"></script>
    <script type="text/javascript" src="../js/audio.js"></script>

    <script type="text/javascript" src="../js/echarts1.js"></script>
    <!--[if lt IE 10]>
    <script src="../js/placeholder.js"></script>
    <![endif]-->

    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=YxrpSNq6119f9xGsRh4Q5f0a5qgy3k00"></script>
    <script src="../js/vue.min.js"></script>
</head>

<body>
<!-- 页面遮罩层 layer -->
<div class="layer"></div>
<!-- 页面头部 header -->
<div class="header">
    <h1 class="logo fl"></h1>
    <span class="mar fl">|</span>
    <span class="fl"><em>团队版</em>[<a href="">点击切换</a>]</span>
    <ul class="nav">
        <li>
            <a href="indexnew2.html" class="current">首页</a>
        </li>
        <!--<li>-->
        <!--<a href="">行动</a>-->
        <!--</li>-->
        <li>
            <a href="customer1.html">客户</a>
        </li>
        <li>
            <a href="download.html">线索</a>
        </li>
        <li>
            <a href="task.html">任务</a>
        </li>
        <li>
            <a href="settings.html" id="top-setting">设置</a>
        </li>
    </ul>
    <ul class="header-right fr">
        <li>
            <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=2656862203&site=qq&menu=yes"><i class="qq"></i>
                <div class="service">在线客服</div>
            </a>
        </li>
        <li>
            <a href="javascript:;"><i class="add"></i></a>
        </li>
        <li>
            <a href="javascript:;"><i class="update"></i></a>
        </li>
        <li>
            <a href="javascript:;"><i class="message"></i></a>
        </li>
        <li>
            <a href="javascript:;" class="user"><img src="../images/a-1.png"/></a>
            <div class="quit_down">
                <div class="code">
                    <img src="../images/download.png"/>
                    <span>扫一扫下载云客APP</span>
                </div>
                <div class="quit_li">
                    <a>下载软电话</a>
                </div>
                <div class="quit_li">
                    <a>退出登录</a>
                </div>
            </div>
        </li>
    </ul>
</div>
<!-- 汇总提示 tipArea -->
<div class="tipArea">
    <div class="wrap">
        <div class="count_f">
            <span class="span-1">数据统计</span>
            <span class="span-1 current">手机统计</span>
            <span class="span-1">签到统计</span>
        </div>
    </div>
</div>
<!-- 内容部分 contents -->
<div class="contents" id="main">
    <!-- 左侧 -->
    <div class="leftPage fl">
        <div class="leftContentBox">
            <div class="tlt">选择组员</div>
            <ul class="choose-members">
                <li>
                    <a href="" class="current"><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>
                <li>
                    <a href=""><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>
                <li>
                    <a href=""><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>
                <li>
                    <a href=""><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>
                <li>
                    <a href=""><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>
                <li>
                    <a href=""><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>
                <li>
                    <a href=""><img src="../images/member.png"><em>艾云鹤</em>
                        <label></label>
                    </a>
                </li>

                <li>
                    <a href=""><img src="../images/all-members.png"><em>全部</em>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <!-- 右侧 -->
    <div class="rightPage">
        <!-- 本周 -->
        <div class="contentsbox" style="display:block">
            <!--  -->
            <div class="tlt"><i></i><label id="charts-title">通话状态</label>
                <span class="f_screen">{{screenCall}}<b class="b-icon"></b>
                 <div class="index_pop">
                    <div class="pop_li" @click="callChartChange(-6,$event)">最近7日</div>
                    <div class="pop_li" @click="callChartChange(-29,$event)">最近30日</div>
                </div>
                </span>
            </div>
            <div class="chartsbox-1" v-callcharts></div>
            <!--  -->
            <div class="tlt"><i></i>里程分析
                <span class="f_screen">{{screenMileage}}<b class="b-icon"></b>
                <div class="index_pop">
                    <div class="pop_li" @click="mapChange(0,$event)">今日</div>
                    <div class="pop_li" @click="mapChange(-1,$event)">昨日</div>
                    <!--<div class="pop_li" @click="mapChange(-6,$event)">最近7日</div>-->
                    <!--<div class="pop_li" @click="mapChange(-29,$event)">最近30日</div>-->
                </div>
                </span>
            </div>
            <div class="index-map" id="index-map"></div>
            <div class="tlt"><i></i>应用统计
                <span class="f_screen">{{screenAPP}}<b class="b-icon"></b>
                <div class="index_pop">
                    <div class="pop_li" @click="chartChange(0,$event)">今日</div>
                    <div class="pop_li" @click="chartChange(-1,$event)">昨日</div>
                    <div class="pop_li" @click="chartChange(-6,$event)">最近7日</div>
                    <div class="pop_li" @click="chartChange(-29,$event)">最近30日</div>
                </div>
                </span>
            </div>
            <div class="chartsbox-1" v-charts></div>
        </div>
        <!-- /本周 -->
    </div>
</div>

<div class="introLayerBox mileage-detail" id="introLayerBox">
    <div class="tel-tlt">
        <i class="i"></i> 里程分析
        <label class="lt-text">({{userName}} {{date}})</label>
        <a href="javascript:closeLayer();" class="a-closed"></a>
    </div>

    <div class="customer">
        <table class="table-list mileage-table" id="table-list">
            <thead>
            <tr>
                <th>定位时间</th>
                <th>定位地点</th>
                <th>停留时间</th>
                <!--<th></th>-->
            </tr>
            </thead>
            <tbody>
            <tr v-for="item in list">
                <td>{{item.date}}</td>
                <td>{{item.address}}</td>
                <td>{{item.duration}}</td>
                <!--<td></td>-->
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script type="text/javascript">
    var name = "艾云鹤";

    var mileageAll = {
        "2017-12-19":[{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 00:08:13","hms":"00:08:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 00:18:13","hms":"00:18:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 00:28:49","hms":"00:28:49"},{"lat":39.784708,"lng":116.388084,"time":"2017-12-19 00:38:49","hms":"00:38:49"},{"lat":39.784708,"lng":116.388084,"time":"2017-12-19 00:48:50","hms":"00:48:50"},{"lat":39.784708,"lng":116.388084,"time":"2017-12-19 00:58:50","hms":"00:58:50"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 01:10:29","hms":"01:10:29"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 01:22:13","hms":"01:22:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 01:32:13","hms":"01:32:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 01:42:13","hms":"01:42:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 01:52:13","hms":"01:52:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 02:02:13","hms":"02:02:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 02:12:13","hms":"02:12:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 02:22:13","hms":"02:22:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 02:32:13","hms":"02:32:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 02:42:13","hms":"02:42:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 02:52:13","hms":"02:52:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 03:02:13","hms":"03:02:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 03:12:13","hms":"03:12:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 03:22:13","hms":"03:22:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 03:32:13","hms":"03:32:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 03:42:13","hms":"03:42:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 03:52:13","hms":"03:52:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 04:02:44","hms":"04:02:44"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 04:15:29","hms":"04:15:29"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 04:26:13","hms":"04:26:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 04:36:13","hms":"04:36:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 04:46:13","hms":"04:46:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 04:56:13","hms":"04:56:13"},{"lat":39.77712133333333,"lng":116.37543158333334,"time":"2017-12-19 05:06:13","hms":"05:06:13"},{"lat":39.90737,"lng":116.483853,"time":"2017-12-19 10:05:44","hms":"10:05:44"},{"lat":39.907119,"lng":116.484073,"time":"2017-12-19 12:22:12","hms":"12:22:12"},{"lat":39.89926045,"lng":116.4699258,"time":"2017-12-19 12:33:39","hms":"12:33:39"},{"lat":39.906469,"lng":116.483195,"time":"2017-12-19 12:43:42","hms":"12:43:42"},{"lat":39.906351,"lng":116.483434,"time":"2017-12-19 12:53:42","hms":"12:53:42"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 13:04:47","hms":"13:04:47"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 13:16:37","hms":"13:16:37"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 13:27:33","hms":"13:27:33"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 13:38:37","hms":"13:38:37"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 13:48:44","hms":"13:48:44"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 14:00:37","hms":"14:00:37"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 14:10:37","hms":"14:10:37"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 14:21:34","hms":"14:21:34"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 14:32:49","hms":"14:32:49"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 14:44:37","hms":"14:44:37"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 14:54:37","hms":"14:54:37"},{"lat":39.90006606666667,"lng":116.47107146666667,"time":"2017-12-19 15:04:37","hms":"15:04:37"}]

    };

    var xAxis = ["云客企业版", "微信", "开心消消乐", "王者荣耀", "微博", "网易云音乐", "短信", "QQ浏览器", "优酷视频", "淘宝", "KEEP", "有道翻译", "LINE"];
    var dataBar = [50, 50, 42, 15, 45, 12, 54, 45, 54, 54, 45, 54, 42];

    var callxAxis = ['2017-10-20', '2017-10-21', '2017-10-22', '2017-10-23', '2017-10-24', '2017-10-25', '2017-10-26'];
    var callData = [
        {
            type: "bar",
            barMaxWidth: 20,
            name: "呼出电话量",
            data: [45, 35, 48, 24, 48, 15, 65]
        },
        {
            type: "bar",
            barMaxWidth: 20,
            name: "呼入电话量",
            data: [36, 15, 45, 21, 35, 45, 25]
        }
    ];

</script>

<script>
    //应用统计
    var optionBar = {
        tooltip: {
            trigger: 'axis',
            formatter: function (val) {
                var duration = val[0].value;
                var name = val[0].name;
                var userName = val[0].seriesName + "<br/>";
                if (duration < 60) {
                    return userName + "使用" + name + "时长：" + parseInt(duration) + "分";
                } else {
                    var l = parseInt(duration % 60);
                    return userName + "使用" + name + "时长：" + parseInt(duration / 60) + "时" + (l == 0 ? "" : (l + "分"));
                }
            }
        },
        grid: {
            left: 70,
            top: 30,
            right: 20,
            bottom: 30
        },
        legend: {
            show: false,
            data: []
        },
        xAxis: [{
            type: 'category',
        }],
        yAxis: [{
            type: 'value',
            min: 0,
            splitNumber: 5,
            splitArea: {
                show: true,
                areaStyle: {
                    color: [
                        'rgba(250,250,250,0.3)',
                        'rgba(200,200,200,0.3)'
                    ]
                }
            },
            axisLabel: {
                formatter: function (duration) {
                    var l = parseInt(duration % 60);
                    return parseInt(duration / 60) + "时" + (l == 0 ? "" : (l + "分"));
                }
            }
        }],
        series: [{
            type: "bar",
            color: ["#50d2c2"],
            barMaxWidth: 50,
            data: []
        }]
    };


    //通话状态
    var optionCall = {
        tooltip: {
            trigger: 'axis',
            formatter: function (val) {
                var span = "";
                for (var i = 0; i < val.length; i++) {
                    span += "<span style='display: inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:" + val[i].color + "'></span>" + val[i].seriesName + "：" + val[i].value + "<br/>";
                }
                return vm.$data.name + "<br/>" + span;
            }
        },
        grid: {
            left: 30,
            top: 55,
            right: 20,
            bottom: 30
        },
        legend: {
            show: true,
            left: 70,
            top: 22,
            data: ['呼出电话量', '呼入电话量'],
            selectedMode: false
        },
        xAxis: [{
            type: 'category',
        }],
        yAxis: [{
            type: 'value',
            name: "单位：个",
            splitArea: {
                show: true,
                areaStyle: {
                    color: [
                        'rgba(250,250,250,0.3)',
                        'rgba(200,200,200,0.3)'
                    ]
                }
            },
            axisLabel: {
                formatter: '{value}'
            }
        }],
        color: ["#50d2c2", '#ffb358'],
        series: []
    };

</script>


<script>

    //设置时间
    Date.prototype.setStr = function (date, str) {
        var all = date.split(/[-: ]/);
        var newDate = new Date();
        var str1 = str.split(/[-: ]/);
        var o = {
            "yyyy": function (y) {
                newDate.setFullYear(y);
            },
            "MM": function (M) {
                newDate.setMonth(M);
            },                 //月份
            "dd": function (d) {
                newDate.setDate(d);
            },                    //日
            "hh": function (h) {
                newDate.setHours(h);
            },                   //小时
            "mm": function (m) {
                newDate.setMinutes(m);
            },                 //分
            "ss": function (s) {
                newDate.setSeconds(s);
            }                 //秒
        };

        for (var a in o) {
            if (new RegExp("(" + a + ")").test(str)) {
                var index = str1.indexOf(a);
                o[a](all[index]);
            }
        }
        return newDate;
    }


    var map, pointArray, chartsBar, chartsCall;

    // 复杂的自定义覆盖物
    function ComplexCustomOverlay(point, name, long, duration) {
        this._point = point;
        this._long = long;
        this._name = name;
        this._duration = duration;
    }

    ComplexCustomOverlay.prototype = new BMap.Overlay();
    ComplexCustomOverlay.prototype.initialize = function (map) {
        this._map = map;
        var div = this._div = document.createElement("div");
        div.className = "index_point";


//        var op = (parseInt(this._long - 10) / 10 >= 4 ? 4 : parseInt(this._long - 10) / 10) * 0.2;
//        var op = (this._long >= 4 ? 4 : this._long) * 0.2;
//        var op = 0.2;
        var hour = parseInt(this._duration / 60);
        var op = (hour >= 3 ? 4 : hour + 1) * 0.2;
        div.style.background = "rgba(189,59,71," + op + ")";
        div.style.border = "2px solid #bd3b47";

        div.setAttribute("name", this._name);

        //根据经纬度获取位置
        var geoc = new BMap.Geocoder();
        geoc.getLocation(this._point, function (rs) {
            div.setAttribute("address", rs.address);
        });

        var divHover = document.createElement("div");
        divHover.className = "index_point_hover";

        var span = document.createElement("span");
        divHover.appendChild(span);
        span.appendChild(document.createTextNode(this._name));
        var label = document.createElement("div");
        divHover.appendChild(label);

        var hour = parseInt(this._duration / 60) > 0 ? parseInt(this._duration / 60) + "小时" : '';
        var minute = parseInt(this._duration % 60) > 0 ? parseInt(this._duration % 60) + "分" : '';
        label.appendChild(document.createTextNode("停留时间：" + hour + minute));

        div.appendChild(divHover);
        map.getPanes().labelPane.appendChild(div);
        return div;
    }
    ComplexCustomOverlay.prototype.draw = function () {
        var map1 = this._map;
        var pixel = map1.pointToOverlayPixel(this._point);
        this._div.style.left = pixel.x - 15 + "px";
        this._div.style.top = pixel.y - 15 + "px";
    }

    function screenShow(count, event) {
        var str = "";
        switch (count) {
            case 0:
                str = "今日";
                break;
            case -1:
                str = "昨日";
                break;
            case -6:
                str = "最近7日";
                break;
            case -29:
                str = "最近30日";
                break;
            default:
                str = count;
                break;
        }
        if (event) {
            event.stopPropagation();
        }
        $(".index_pop").hide();
        return str;
    }


    var vm = new Vue({
        el: "#main",
        data: {
            //销售姓名
            name: "",
            //里程分析
            mileage: [],
            chartBar: {
                barData: [],
                barAxis: []
            },
            callChart: {
                callAxis: [],
                callSeries: []
            },
            screenCall: "最近7日",
            screenMileage: "今日",
            screenAPP: "今日"
        },
        methods: {
            //地图根据经纬度加点
            creatOverlay: function (data) {
                map.clearOverlays();//清空地图上标注点
                pointArray = new Array();
                for (var index = 0; index < data.point.length; index++) {
                    var point = new BMap.Point(data.point[index].lng, data.point[index].lat);
                    pointArray.push(point);
                    var start = new Date().setStr(data.point[index].time,'yyyy-MM-dd hh:mm:ss').valueOf();
                    var end = new Date().setStr(data.point[index].end,'yyyy-MM-dd hh:mm:ss').valueOf();
                    var duration = (end - start) / 1000 / 60;
                    var div = new ComplexCustomOverlay(point, data.name, data.point[index].long, duration);
                    map.addOverlay(div);
                }
                mapCenter();

            },
            //修改柱状图的数据
            chartChange: function (num, event) {
                this.$data.screenAPP = screenShow(num, event);


                this.$data.chartBar.barData = [];
                this.$data.chartBar.barAxis = [];
                for (var i = 0; i < 10; i++) {
                    this.$data.chartBar.barData.push(dataBar[parseInt(Math.random() * 13)]);
                    this.$data.chartBar.barAxis.push(xAxis[parseInt(Math.random() * 13)]);
                }
            },
            //修改通话状态
            callChartChange: function (num, event) {

                this.$data.screenCall = screenShow(num, event);


                this.$data.callChart.callAxis = callxAxis;
                this.$data.callChart.callSeries = callData;
            },
            //地图选择销售
            mileageSelect: function (index) {
                this.creatOverlay(this.$data.mileage[index]);
            },
            //修改地图数据
            mapChange: function (num, event) {
                this.$data.screenMileage = screenShow(num, event);
                this.$data.mileage = [];
                for (var i = 0; i < 1; i++) {
                    var point = [];
                    for (var key in mileageAll) {
                        var item = mileageAll[key];
                        var datum = {};
                        var long;
                        for (var j = 1; j < item.length; j++) {
                            if (JSON.stringify(datum) == '{}') {
                                datum = item[0];
                                long = 0;
                                datum.duration = item[0].hms;
                            }
                            if ((map.getDistance(new BMap.Point(datum.lng, datum.lat), new BMap.Point(item[j].lng, item[j].lat))).toFixed(2) < 150) {
                                long++;
                                if (j == item.length - 1) {
                                    datum.date = key;
                                    datum.long = long;
                                    datum.duration += "-" + item[j].hms;
                                    datum.end = item[j].time;
                                    point.push(datum);
                                }
                            } else {
                                if (long > 0) {
                                    datum.date = key;
                                    datum.long = long;
                                    datum.duration += "-" + item[j - 1].hms;
                                    datum.end = item[j - 1].time;
                                    point.push(datum);
                                }
                                datum = item[j];
                                datum.duration = item[j].time;

                                long = 0;
                            }
                        }
                    }
                    this.$data.mileage.push({
                        name: name,
                        point: point
                    });
                }

                console.log(this.$data.mileage);
                console.log(JSON.stringify(this.$data.mileage));
                this.mileageSelect(0);
            }
        },
        directives: {
            charts: {
                inserted: function (el) {
                    chartsBar = echarts.init(el);
                }
            },
            callcharts: {
                inserted: function (el) {
                    chartsCall = echarts.init(el);
                }
            }
        },
        watch: {
            chartBar: {
                handler: function (val) {
                    optionBar.xAxis[0].data = val.barAxis;
                    optionBar.series[0].data = val.barData;
                    optionBar.series[0].name = name;

                    var max = Math.max.apply(null, val.barData);
                    var interval = max % 5 > 0 ? parseInt((max - max % 5) / 5) + 1 : parseInt(max / 5);
                    if (interval % 60 > 0) {
                        interval = parseInt(interval / 60 + 1) * 60;
                    }
                    max = parseInt(5 * interval);
                    optionBar.yAxis[0].max = max;
                    optionBar.yAxis[0].interval = interval;

                    chartsBar.setOption(optionBar);
                },
                deep: true
            },
            callChart: {
                handler: function (val) {
                    optionCall.xAxis[0].data = val.callAxis;
                    optionCall.series = val.callSeries;
                    chartsCall.setOption(optionCall);
                },
                deep: true
            }
        },
        //初始化数据
        mounted: function () {
            var _self = this;
            creatMap();

            //修改柱状图数据
            this.chartChange(0);
            this.mapChange(0);
            this.callChartChange(-6);
            this.$data.name = name;
        }

    });

    $(function () {
        //里程分析中选择销售
        $(document).on("click", ".swiper-slide", function () {
            vm.mileageSelect($(this).index());
        });

        //地图中圆点的点击事件
        $(document).on("click", ".index_point", function () {
//            window.open("mileage.html#"+escape(JSON.stringify(vm.$data.mileage[0])));
            $(".layer").show();
            $("#introLayerBox").show();

            detail.showLocation();
        });


        //通话状态图表点击事件
        chartsCall.on('click', function (params) {
            console.log(params);
        });

        $(document).on("click", ".f_screen", function (e) {
            e.stopPropagation();
            $(this).find(".index_pop").show();
        });
        $(document).click(function () {
            $(".index_pop").hide();
        });


    });

    //初始化地图
    function creatMap() {
        map = new BMap.Map("index-map", {enableMapClick: false}); //初始化地图
        map.centerAndZoom(new BMap.Point(116.404, 39.915), 15); //地图显示位置
        map.enableDragging();  //拖拽
//        map.enableScrollWheelZoom();//滚轮改变大小
        var navigationControl = new BMap.NavigationControl();
        map.addControl(navigationControl);
    }

    //地图居中
    function mapCenter() {
        setTimeout(function () {
            map.setViewport(pointArray, {margins: [20, 20, 20, 20]});
        }, 50);
    }


    var mileage, index = 0;
    var geoc = new BMap.Geocoder();

    var detail = new Vue({
        el: "#introLayerBox",
        data: {
            userName: "",
            date: "",
            list: [],
            points: []
        },
        methods: {
            showLocation: function () {
                var _self = this;
                //根据经纬度获取位置
                _self.$data.userName = "";
                _self.$data.date = "";
                _self.$data.list = [];
                _self.$data.points = [];
                index = 0;
                $.get("../mileage.json", function (data) {
                    mileage = data;

                    _self.$data.userName = mileage.userName;
                    _self.$data.date = mileage.date;
                    var items = mileage.data;

                    for (var i = 0; i < items.length; i++) {
                        var dayPoints = items[i].items;
                        for (var j = 0; j < dayPoints.length; j++) {
                            _self.$data.points.push(new BMap.Point(dayPoints[j].lng, dayPoints[j].lat));
                            _self.$data.list.push({
                                date: items[i].day + " " + dayPoints[j].yms,
                                duration: dayPoints[j].duration,
                                address: ""
                            });
                        }
                    }

                    bdGEO(0);
                })
            }
        },
        mounted: function () {

        }
    });


    function bdGEO() {
        var pt = detail.$data.points[index];
        geocodeSearch(pt);
    }

    function geocodeSearch(pt) {
        if (index < detail.$data.points.length) {
            geoc.getLocation(pt, function (rs) {
                detail.$data.list[index]['address'] = rs.address;
                index++;
                setTimeout(window.bdGEO, 2);
            });
        }
    }

    function closeLayer() {
        $(".layer").hide();
        $("#introLayerBox").hide();
    }


</script>

</body>

</html>